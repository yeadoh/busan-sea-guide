<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Silver Guestbook</title>
    <link rel="stylesheet" href="busan-sea-guide/assets/css/gueststyle.css">
</head>
<body>

<div class="glass-container">
    <section class="write-area">
        <h2 class="title">MEMORIES</h2>
        <form id="guestForm">
            <div class="input-box">
                <textarea id="guestContent" name="comment" placeholder="ë°”ë‹¤ë¥¼ ìˆ˜ë†“ì€, ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”..." required></textarea>
                
                <div class="action-bar">
                    <div class="file-wrapper">
                        <label for="photo-upload">
                            <span class="icon">ğŸ“·</span> ì‚¬ì§„ ì„ íƒ
                        </label>
                        <input type="file" id="photo-upload" name="photo" accept="image/*">
                    </div>
                    <button type="submit" class="btn-submit">ì…ë ¥</button>
                </div>
            </div>
        </form>
    </section>

    <hr class="divider">

    <section class="display-area">
        <div class="list-header">
            <span>Recent Guest</span>
            <span id="recordCount" class="count">0 Records</span>
        </div>

        <div class="post-list" id="postList">
       
        </div>
    </section>
</div>

<script>
const guestForm = document.getElementById('guestForm');
const postList = document.getElementById('postList');
const guestContent = document.getElementById('guestContent');
const recordCount = document.getElementById('recordCount');
const photoUpload = document.getElementById('photo-upload');
const fileLabel = document.querySelector('.file-wrapper label');

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
window.addEventListener('DOMContentLoaded', loadPosts);

// 1. ì‚¬ì§„ ì„ íƒ ì‹œ íŒŒì¼ëª… í‘œì‹œ
photoUpload.addEventListener('change', function() {
    if (this.files && this.files[0]) {
        const fileName = this.files[0].name;
        const displayWait = fileName.length > 10 ? fileName.substring(0, 10) + "..." : fileName;
        fileLabel.innerHTML = `<span class="icon">âœ…</span> ${displayWait}`;
        fileLabel.style.color = "#5bc0de";
    } else {
        fileLabel.innerHTML = `<span class="icon">ğŸ“·</span> ì‚¬ì§„ ì„ íƒ`;
        fileLabel.style.color = "#aaa";
    }
});

// 2. ë°©ëª…ë¡ ë“±ë¡ ë° ì €ì¥
guestForm.addEventListener('submit', function(e) {
    e.preventDefault(); 

    const text = guestContent.value;
    const file = photoUpload.files[0];
    const now = new Date();
    const dateStr = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;

    // ì´ë¯¸ì§€ íŒŒì¼ì„ Base64 ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥í•  ì¤€ë¹„
    if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const imageData = event.target.result;
            saveAndRenderPost(text, dateStr, imageData);
        };
        reader.readAsDataURL(file);
    } else {
        saveAndRenderPost(text, dateStr, null);
    }

    // ì…ë ¥ì°½ ì´ˆê¸°í™”
    guestContent.value = '';
    photoUpload.value = ''; 
    fileLabel.innerHTML = `<span class="icon">ğŸ“·</span> ì‚¬ì§„ ì„ íƒ`;
    fileLabel.style.color = "#aaa";
});

// í¬ìŠ¤íŠ¸ë¥¼ í™”ë©´ì— ê·¸ë¦¬ê³  ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
function saveAndRenderPost(text, date, imageSrc) {
    const postData = { text, date, imageSrc };
    
    // í™”ë©´ì— ì¶”ê°€
    renderPost(postData);

    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥
    const savedPosts = JSON.parse(localStorage.getItem('guestbookPosts') || '[]');
    savedPosts.unshift(postData);
    localStorage.setItem('guestbookPosts', JSON.stringify(savedPosts));
    
    updateCount();
}

// í™”ë©´ì— í¬ìŠ¤íŠ¸ë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
function renderPost(data) {
    const newCard = document.createElement('article');
    newCard.className = 'post-card';
    
    let imageHtml = data.imageSrc ? `<img src="${data.imageSrc}" style="width:100%; border-radius:12px; margin-bottom:12px; display:block; object-fit:cover; max-height:300px;">` : '';

    newCard.innerHTML = `
        ${imageHtml}
        <p class="post-content">${data.text}</p>
        <div class="post-meta">${data.date} | Guest</div>
    `;

    postList.prepend(newCard);
}

// ì €ì¥ëœ í¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
function loadPosts() {
    const savedPosts = JSON.parse(localStorage.getItem('guestbookPosts') || '[]');
    // ë°°ì—´ì„ ë’¤ì§‘ì–´ì„œ(ì˜¤ë˜ëœ ê²ƒë¶€í„°) ìˆœì„œëŒ€ë¡œ prepend í•´ì•¼ ìµœì‹ ìˆœìœ¼ë¡œ ë³´ì„
    savedPosts.reverse().forEach(post => renderPost(post));
    updateCount();
}

// ê¸°ë¡ ê°œìˆ˜ ì—…ë°ì´íŠ¸
function updateCount() {
    const currentCount = postList.querySelectorAll('.post-card').length;
    recordCount.innerText = `${currentCount} Records`;
}
</script>

</body>
</html>

